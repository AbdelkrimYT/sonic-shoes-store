<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />
    <title>Sonic Shoes - prodecy name</title>
    <style>
        header {
            text-align: center;
        }

        .banner {
            padding: 12px;
            background-color: black;
            color: white;
            font-size: 16px;
        }

        .logo {
            padding: 24px;
            border-bottom-style: solid;
            border-bottom-width: 1px;
        }

        .logo > strong {
            color: #E42217;
            font-size: 24px;
            font-style: italic;
        }

        .logo > img {
            display: inline;
            width: 32px;
            height: 32px;
        }

        section {
            margin: 12px;
        }
    </style>
</head>
<body>
    <header>
        <div class="banner">
            <strong>
                اطلب الآن واستمتع بخدمة الدفع عند الاستلام لضمان راحتك واطمئنانك
            </strong>
        </div>
        <div class="logo">
            <strong>
                Sonic Shoes
            </strong>
            <img src="./assets/logo.png" />
        </div>
    </header>

  <main>
    <section class="max-w-sm mx-auto">

        <div id="default-carousel" class="relative w-full" data-carousel="slide">
            <div id="view-image" class="relative h-96 overflow-hidden rounded-sm">
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img>
                </div>
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img>
                </div>
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img>
                </div>
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img>
                </div>
                <div class="hidden duration-700 ease-in-out" data-carousel-item>
                    <img>
                </div>
            </div>
            <button type="button" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 group-hover:bg-white/50 group-focus:ring-4 group-focus:ring-white group-focus:outline-none">
                    <svg class="w-4 h-4 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                    </svg>
                    <span class="sr-only">السابق</span>
                </span>
            </button>
            <button type="button" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/30 group-hover:bg-white/50 group-focus:ring-4 group-focus:ring-white group-focus:outline-none">
                    <svg class="w-4 h-4 text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                    </svg>
                    <span class="sr-only">التالي</span>
                </span>
            </button>
        </div>

        <div class="mt-4">
            <strong id="view-name" class="text-4xl text-gray-900"></strong>
            <p class="text-2xl text-gray-900">فقط بـ <span id="view-price"></span>دج</p>
        </div>

        <div class="rounded-sm border mt-4 p-4">
            <div class="mb-5">
                <label for="fullname" class="block mb-2 text-sm font-medium text-gray-900">الاسم الشخصي</label>
                <input type="text" id="fullname" onchange="changeOrderCustomerName()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
            </div>
            <div class="mb-5">
                <label for="phone" class="block mb-2 text-sm font-medium text-gray-900">رقم الهاتف</label>
                <input type="text" id="phone" onchange="changeOrderCustomerPhone()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5" maxlength="10">
            </div>
            <div class="mb-5">
                <label for="view-state" class="block mb-2 text-sm font-medium text-gray-900">الولاية</label>
                <select id="view-state" onchange="changeCommune()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                    <option></option>
                </select>
            </div>
            <div class="mb-5">
                <label for="view-commune" class="block mb-2 text-sm font-medium text-gray-900">البلدية</label>
                <select id="view-commune" onchange="changeOrderCommune()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                </select>
            </div>
        </div>

        <div class="mt-4">
            <div class="mb-4 flex items-center ps-4 border border-gray-200 rounded">
                <input id="view-to-office" type="radio" value="to-office" name="delivery-to" disabled onclick="setCostToOffice()" class="w-4 h-4 text-red-500 bg-gray-100 border-gray-300 focus:ring-red-400">
                <label for="view-to-office" class="w-full py-4 ms-2 text-sm font-medium text-gray-900">توصيل للمكتب</label>
            </div>
            <div class="flex items-center ps-4 border border-gray-200 rounded">
                <input id="view-to-home" type="radio" value="to-home" name="delivery-to" disabled onclick="setCostToHome()" class="w-4 h-4 text-red-500 bg-gray-100 border-gray-300 focus:ring-red-400">
                <label for="view-to-home" class="w-full py-4 ms-2 text-sm font-medium text-gray-900">توصيل للمنزل</label>
            </div>
        </div>

        <div class="mt-4">
            <div class="rounded-sm border p-4">
                <div class="mb-5">
                    <label for="view-color" class="block mb-2 text-sm font-medium text-gray-900">اللون</label>
                    <select id="view-color" name="color" onchange="changeOrderColor()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                    </select>
                </div>
                <div class="mb-5">
                    <label for="view-size" class="block mb-2 text-sm font-medium text-gray-900">المقاس</label>
                    <select id="view-size" name="size" onchange="changeOrderSize()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                    </select>
                </div>
                <div class=mb-5"">
                    <label for="quantity" class="block mb-2 text-sm font-medium text-gray-900">الكمية</label>
                    <input id="quantity" name="quantity" type=number min="1" value="1" onchange="changeQuantity()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-red-500 focus:border-red-500 block w-full p-2.5">
                </div>
            </div>

            <div class="mt-4 bg-red-50 border rounded-sm border-red-300">
                <div class="p-4">
                    <strong>
                        ملخص الطلب
                    </strong>
                </div>
                <div class="p-4">
                    <ul class="max-w-md">
                        <li class="pb-3 sm:pb-4">
                           <div class="flex items-center space-x-4 rtl:space-x-reverse">
                              <div class="flex-1 min-w-0">
                                 <p id="view-order-name" class="text-sm font-medium text-gray-900 truncate">
                                 </p>
                                 <p class="text-sm text-gray-500 truncate">
                                    <span id="view-order-quantity">1</span>x
                                 </p>
                              </div>
                              <div class="inline-flex items-center text-base font-semibold text-gray-900">
                                    <span id="view-order-price"></span><span>دج</span>
                              </div>
                           </div>
                        </li>
                        <li class="pb-3 sm:pb-4">
                            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                               <div class="flex-1 min-w-0">
                                  <p class="text-sm font-medium text-gray-900 truncate">
                                    تكلفة التوصيل
                                  </p>
                               </div>
                               <div class="inline-flex items-center text-base font-semibold text-gray-900">
                                  <span id="view-order-cost">0</span><span>دج</span>
                               </div>
                            </div>
                         </li>
                         <hr>
                         <li class="mt-4 pb-3 sm:pb-4">
                            <div class="flex items-center space-x-4 rtl:space-x-reverse">
                               <div class="flex-1 min-w-0">
                                  <p class="text-sm font-medium text-gray-900 truncate">السعر الاجمالي</p>
                               </div>
                               <div class="inline-flex items-center text-base font-semibold text-gray-900">
                                  <span id="view-order-total">0</span><span>دج</span>
                               </div>
                            </div>
                         </li>
                     </ul>
                </div>
            </div>

            <button id="send-order" type="button" onclick="makeOrder()" data-modal-target="popup-modal" data-modal-toggle="popup-modal" class="mt-4 w-full focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-sm text-sm px-5 py-2.5 me-2 mb-2">
                تأكيد الطلب
            </button>

          </div>
    </section>
  </main>

    <div id="popup-modal" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
        <div class="relative p-4 w-full max-w-md max-h-full">
            <div class="relative bg-white rounded-lg shadow">
                <div class="p-4 md:p-5 text-center">
                    <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.5 11.5 11 14l4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                    </svg>                      
                    <h3 class="mb-5 text-lg font-normal text-gray-500">تم استقبال طلبكم بنجاح، سيتم التواصل معكم بعد قليل، شكرا لثقتكم</h3>
                    <button data-modal-hide="popup-modal" type="button" class="text-white bg-green-400 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center">
                        اغلاق
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>

    <script>
    const URL_PRODUCTS = 'https://raw.githubusercontent.com/AbdelkrimYT/sonic-shoes-store/main/data/product.json';
    const URL_STATES = 'https://raw.githubusercontent.com/AbdelkrimYT/sonic-shoes-store/main/data/states.json';
    const URL_DELIVERY_COST = 'https://raw.githubusercontent.com/AbdelkrimYT/sonic-shoes-store/main/data/delivery.json';
    
    const products = [];
    const states = [];
    const delivery_cost_list = [];

    const order = {
        "customer_name": "",
        "customer_phone": "",
        "product_name": "",
        "quantity": 1,
        "state": "",
        "commene": "",
        "cost": 0,
        "total": 0
    };

    axios.get(URL_PRODUCTS)
    .then(response => {

        response.data.forEach(e => {
            products.push(e);
        });

        const urlQuery = new URLSearchParams(window.location.search);
        const qSlug = urlQuery.get('slug');
        const qProduct = response.data.find(e => e.slug === qSlug);

        if (qProduct) {
            
            const product_colors = document.getElementById('view-color');
            const product_size = document.getElementById('view-size');

            axios.get(URL_STATES)
            .then(response => {
                const state_select = document.getElementById('view-state');
                
                response.data.forEach(e => {
                    let option = document.createElement('option');
                    option.value = e.code;
                    option.innerHTML = e.name;
                    state_select.appendChild(option);
                    states.push(e);
                });

            }).catch(error => console.log(error));

            axios.get(URL_DELIVERY_COST)
            .then(response => {
                response.data.forEach(e => {
                    delivery_cost_list.push(e);
                });
            }).catch(error => console.log(error));

            qProduct.colors.forEach(e => {
                const option = document.createElement('option');
                option.innerText = e;
                product_colors.appendChild(option);
            });

            qProduct.size.forEach(e => {
                const option = document.createElement('option');
                option.innerText = e;
                product_size.appendChild(option);
            });

            order.product_name = qProduct.name;
            order.price = qProduct.price;
            order.total = order.quantity * order.price;

            document.getElementById('view-name').innerText = qProduct.name;
            document.getElementById('view-price').innerText = qProduct.price;
            document.getElementById('view-order-name').innerText = qProduct.name;
            document.getElementById('view-order-price').innerText = qProduct.price;
            document.getElementById('view-order-total').innerText = order.total;

            const images = document.getElementById('view-image').getElementsByTagName('img');

            for (let i = 0; i < qProduct.images.length; i++) {
                images[i].setAttribute('src', qProduct.images[i]);
            }

        } else {
            alert('لم يتم العثور على المنتج');
        }

    }).catch((error) => {
        console.log(error);
    });

    function changeOrderCustomerName() {
        order.customer_name = document.getElementById('fullname').value;
    }

    function changeOrderCustomerPhone() {
        order.customer_phone = document.getElementById('phone').value;
    }
 
    function changeCommune() {
        const change_code = document.getElementById('view-state').value;
        const commune_element = document.getElementById('view-commune');

        while (commune_element.length > 0)
            commune_element.remove(0);

        if (!change_code)
        {
            document.getElementById('view-to-office').disabled = true;
            document.getElementById('view-to-home').disabled = true;
            document.getElementById('view-to-office').checked = false;
        document.getElementById('view-to-home').checked = false;
        document.getElementById('view-order-cost').innerText = '';
            return;
        }

        const state = states.find(e => e.code == change_code);
        
        state.communes.forEach(e => {
            const option = document.createElement('option');
            option.value = e.name;
            option.innerHTML = e.name;
            commune_element.appendChild(option);
        });

        order.state = state.name;
        order.commene = state.communes[0].name;

        document.getElementById('view-to-office').disabled = false;
        document.getElementById('view-to-home').disabled = false;

        document.getElementById('view-to-office').checked = false;
        document.getElementById('view-to-home').checked = false;
        document.getElementById('view-order-cost').innerText = '';
    }

    function changeOrderCommune() {
        order.commene = document.getElementById('view-commune').value;
    }

    function changeOrderColor() {
        const color = document.getElementById('view-color').value;
        order.color = color;
    }

    function changeOrderSize() {
        const size = document.getElementById('view-size').value;
        order.size = size;
    }

    function changeQuantity() {
        order.quantity = document.getElementById('quantity').value;
        order.total = (order.quantity * order.price) + order.cost;

        document.getElementById('view-order-quantity').innerText = order.quantity;
        document.getElementById('view-order-total').innerText = order.total;
    }

    function setCostToOffice() {
        const state_code = document.getElementById('view-state').value;
        const current_cost = delivery_cost_list.find(e => e.code == state_code).price.to_office;

        if (current_cost == 0)
        {
            alert('شركة النقل لاتوفل خدمة الشحن للمكتب لهاذه البلدية');
            return;
        }

        order.cost = current_cost;
        order.total = (order.quantity * order.price) + order.cost;

        document.getElementById('view-order-cost').innerText = current_cost;
        document.getElementById('view-order-total').innerText = order.total;
    }

    function setCostToHome() {
        const state_code = document.getElementById('view-state').value;
        const current_cost = delivery_cost_list.find(e => e.code == state_code).price.to_home;
        
        if (current_cost == 0)
        {
            alert('شركة النقل لاتوفل خدمة الشحن للمنزل لهاذه البلدية');
            return;
        }

        order.cost = current_cost;
        order.total = (order.quantity * order.price) + order.cost;

        document.getElementById('view-order-cost').innerText = current_cost;
        document.getElementById('view-order-total').innerText = order.total;
    }


    function makeOrder() {
        console.log(order);
    }

    </script>

</body>
</html>